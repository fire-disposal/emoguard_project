<!-- 流程测评页面，风格参考 detail -->
<view class="assessment-container">
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">加载中...</text>
  </view>

  <view wx:elif="{{!finished}}" class="assessment-content">
    <view class="header-bar">
      <text class="header-title">{{scaleList[currentScaleIndex].name}}</text>
    </view>
    <view wx:if="{{questions.length === 0}}" class="empty-state">
      <text class="empty-text">暂无题目</text>
    </view>
    <view class="progress-bar" wx:if="{{questions.length > 0}}">
      <view class="progress-fill" style="width: {{(currentQuestionIndex + 1) / questions.length * 100}}%"></view>
    </view>
    <view class="progress-text" wx:if="{{questions.length > 0}}">
      <text>{{currentQuestionIndex + 1}}/{{questions.length}}</text>
    </view>
    <view class="question-section card" wx:if="{{questions.length > 0 && questions[currentQuestionIndex]}}">
      <view class="question-number">第 {{currentQuestionIndex + 1}} 题</view>
      <text class="question-text">{{questions[currentQuestionIndex].question}}</text>
      <view class="options-list" wx:if="{{questions[currentQuestionIndex].options}}">
        <view
          wx:for="{{questions[currentQuestionIndex].options}}"
          wx:key="index"
          class="option-item {{selectedOptions[currentQuestionIndex] === index ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="selectOption"
        >
          <view class="option-radio">
            <view wx:if="{{selectedOptions[currentQuestionIndex] === index}}" class="radio-checked"></view>
          </view>
          <text class="option-text">{{item.text || item}}</text>
        </view>
      </view>
    </view>
    <view class="action-buttons" wx:if="{{questions.length > 0}}">
      <view
        class="btn-secondary {{currentQuestionIndex === 0 ? 'btn-disabled' : ''}}"
        bindtap="prevQuestion"
      >
        <text>上一题</text>
      </view>
      <view
        wx:if="{{currentQuestionIndex < questions.length - 1}}"
        class="btn-primary"
        bindtap="nextQuestion"
      >
        <text>下一题</text>
      </view>
      <view
        wx:elif="{{currentQuestionIndex === questions.length - 1}}"
        class="btn-primary"
        bindtap="submitScale"
      >
        <text>提交问卷</text>
      </view>
    </view>
  </view>

  <view wx:elif="{{finished}}" class="result-container">
    <view class="result-card">
      <view class="result-header">
        <text class="result-title">测评结果</text>
        <text class="result-time">{{localResult.timestamp}}</text>
      </view>
      
      <view class="result-content">
        <view class="score-section">
          <text class="score-text">{{localResult.scoreText}}</text>
          <text class="status-text" style="color: {{localResult.statusColor}};">{{localResult.statusText}}</text>
        </view>
        
        <view class="result-description">
          <text class="desc-text">{{localResult.resultText}}</text>
        </view>
        
        <view wx:if="{{submitting}}" class="submit-status">
          <view class="loading-spinner"></view>
          <text class="submit-text">正在提交结果，请稍候...</text>
        </view>
        
        <view wx:elif="{{!submitting && !submitSuccess}}" class="submit-hint">
          <text class="hint-text">结果将在3秒后自动提交</text>
        </view>
        
        <view wx:elif="{{submitSuccess}}" class="submit-success-hint">
          <text class="success-hint-text">✓ 结果已成功提交</text>
        </view>
      </view>
    </view>
    
    <view class="manual-submit-section" wx:if="{{!submitting && !submitSuccess}}">
      <view class="btn-primary" bindtap="manualSubmit">
        <text>立即提交</text>
      </view>
    </view>
  </view>
</view>
