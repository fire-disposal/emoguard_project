<!--pages/assessment/result/result.wxml-->
<view class="result-container gradient-bg">
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 流程测评结果展示 -->
  <view wx:elif="{{flowResult}}" class="result-content">
    <view class="complete-icon">✓</view>
    <text class="complete-text">流程测评完成</text>
    <view class="result-card card">
      <text class="scale-name">本地分析</text>
      <view wx:for="{{flowResult.local}}" wx:key="scale">
        <view class="conclusion-section">
          <text class="section-label">{{item.scale}} 分析</text>
          <text class="conclusion-text">{{item.analysis.interpretation}}</text>
        </view>
        <view class="analysis-section">
          <text class="section-label">详细分数</text>
          <view class="analysis-content">
            <text>得分：{{item.analysis.score}}</text>
          </view>
        </view>
      </view>
      <view class="conclusion-section" wx:if="{{flowResult.remote}}">
        <text class="section-label">后端存档信息</text>
        <text class="conclusion-text">{{flowResult.remote.message || flowResult.remote.detail || flowResult.remote.status || flowResult.remote.id}}</text>
      </view>
    </view>
    <view class="action-buttons">
      <view class="btn-secondary" bindtap="goHome">
        <text>返回首页</text>
      </view>
      <view class="btn-primary" bindtap="goToReports">
        <text>查看报告</text>
      </view>
    </view>
  </view>

  <!-- 单量表结果展示 -->
  <view wx:elif="{{result}}" class="result-content">
    <!-- 完成提示 -->
    <view class="complete-icon">✓</view>
    <text class="complete-text">测评完成</text>

    <!-- 结果卡片 -->
    <view class="result-card card">
      <text class="scale-name">{{result.scale_config.name}}</text>
      
      <view wx:if="{{result.conclusion}}" class="conclusion-section">
        <text class="section-label">测评结论</text>
        <text class="conclusion-text">{{result.conclusion}}</text>
      </view>

      <view wx:if="{{result.analysis}}" class="analysis-section">
        <text class="section-label">详细分析</text>
        <view class="analysis-content">
          <block wx:for="{{Object.keys(result.analysis)}}" wx:key="*this">
            <view class="analysis-item">
              <text class="analysis-key">{{item}}:</text>
              <text class="analysis-value">{{result.analysis[item]}}</text>
            </view>
          </block>
        </view>
      </view>

      <view class="time-info">
        <text class="time-label">完成时间：</text>
        <text class="time-value">{{result.completed_at}}</text>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <view class="btn-secondary" bindtap="goHome">
        <text>返回首页</text>
      </view>
      <view class="btn-primary" bindtap="goToReports">
        <text>查看报告</text>
      </view>
    </view>
  </view>
</view>
