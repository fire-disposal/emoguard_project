<!--pages/assessment/detail/detail.wxml-->
<view class="assessment-container">
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">加载中...</text>
  </view>

  <view wx:elif="{{scaleConfig}}" class="assessment-content">
    
    <!-- 调试信息 -->
    <!-- <view style="padding: 20rpx; background: #f0f0f0; font-size: 24rpx; color: #666; margin-bottom: 20rpx;">
      <text>调试: 问题数={{questions.length}}, 当前索引={{currentQuestionIndex}}</text>
      <text wx:if="{{questions.length > 0}}">, 当前问题={{questions[currentQuestionIndex].question}}</text>
    </view> -->
    
    <!-- 顶栏 - 问卷名称 -->
    <view class="header-bar">
      <text class="header-title">{{scaleConfig.name}}</text>
    </view>

    <!-- 空状态提示 -->
    <view wx:if="{{questions.length === 0}}" class="empty-state">
      <text class="empty-text">暂无题目</text>
    </view>

    <!-- 进度条 -->
    <view class="progress-bar" wx:if="{{questions.length > 0}}">
      <view class="progress-fill" style="width: {{(currentQuestionIndex + 1) / questions.length * 100}}%"></view>
    </view>
    <view class="progress-text" wx:if="{{questions.length > 0}}">
      <text>{{currentQuestionIndex + 1}}/{{questions.length}}</text>
    </view>

    <!-- 当前题目 -->
    <view class="question-section card" wx:if="{{questions.length > 0 && questions[currentQuestionIndex]}}">
      <view class="question-number">第 {{currentQuestionIndex + 1}} 题</view>
      <text class="question-text">{{questions[currentQuestionIndex].question}}</text>

      <!-- 选项 -->
      <view class="options-list" wx:if="{{questions[currentQuestionIndex].options}}">
        <view
          wx:for="{{questions[currentQuestionIndex].options}}"
          wx:key="index"
          class="option-item {{selectedOptions[currentQuestionIndex] === index ? 'selected' : ''}}"
          data-index="{{index}}"
          bindtap="selectOption"
        >
          <view class="option-radio">
            <view wx:if="{{selectedOptions[currentQuestionIndex] === index}}" class="radio-checked"></view>
          </view>
          <text class="option-text">{{item.text || item}}</text>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons" wx:if="{{questions.length > 0}}">
      <view
        class="btn-secondary {{currentQuestionIndex === 0 ? 'btn-disabled' : ''}}"
        bindtap="prevQuestion"
      >
        <text>上一题</text>
      </view>

      <view
        wx:if="{{currentQuestionIndex < questions.length - 1}}"
        class="btn-primary"
        bindtap="nextQuestion"
      >
        <text>下一题</text>
      </view>

      <view
        wx:elif="{{currentQuestionIndex === questions.length - 1}}"
        class="btn-primary"
        bindtap="submitAssessment"
      >
        <text>提交问卷</text>
      </view>
    </view>
  </view>
</view>
