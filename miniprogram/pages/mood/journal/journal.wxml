<!--pages/mood/journal/journal.wxml-->
<view class="mood-container gradient-bg">
  <!-- 心情记录模块 - 重构为题目形式 -->
  <view class="mood-record-section card">

    <!-- 题目1：主观情绪 -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">主观情绪</text>
        <text class="question-subtitle">您现在主要是什么感觉？</text>
      </view>
      <view class="question-content">
        <view class="mood-options">
          <view 
            wx:for="{{questions[0].options}}" 
            wx:key="value"
            class="mood-option {{mainMood === item.value ? 'selected' : ''}}"
            bindtap="handleMoodSelect" 
            data-key="mainMood" 
            data-value="{{item.value}}"
          >
            <view class="mood-emoji">{{item.emoji}}</view>
            <text class="mood-text">{{item.text}}</text>
          </view>
        </view>
        <view wx:if="{{mainMood === 'other'}}" class="other-mood-input">
          <input placeholder="请填写其他情绪" value="{{mainMoodOther}}"
                 data-key="mainMoodOther" bindinput="handleTextChange"/>
        </view>
      </view>
    </view>

    <!-- 题目2：情绪强度 -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">情绪强度</text>
        <text class="question-subtitle">您当前感受的强度如何？</text>
      </view>
      <view class="question-content">
        <view class="slider-group">
          <slider
            min="{{questions[1].min}}"
            max="{{questions[1].max}}"
            step="{{questions[1].step}}"
            value="{{moodIntensity || 5}}"
            show-value="true"
            data-key="moodIntensity"
            bindchange="handleSliderChange"
          />
          <text class="slider-value">当前强度：{{moodIntensity || 5}}/10</text>
        </view>
      </view>
    </view>

    <!-- 题目3：情绪原因 -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">情绪原因</text>
        <text class="question-subtitle">导致此情绪的原因（可多选）</text>
      </view>
      <view class="question-content">
        <checkbox-group class="checkbox-group" data-key="moodSupplementTags" bindchange="handleCheckboxChange">
          <label 
            wx:for="{{questions[2].options}}" 
            wx:key="value" 
            wx:for-item="item"
            class="checkbox-option {{getCheckboxSelected(2, item.value) ? 'selected' : ''}}"
          >
            <checkbox value="{{item.value}}" checked="{{getCheckboxSelected(2, item.value)}}" />
            <text class="checkbox-text">{{item.text}}</text>
          </label>
        </checkbox-group>
      </view>
    </view>

    <!-- 题目4：补充说明 -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">补充说明</text>
        <text class="question-subtitle">请简短写下导致此情绪的事情</text>
      </view>
      <view class="question-content">
        <textarea 
          class="text-input"
          placeholder="{{questions[3].placeholder}}"
          value="{{moodSupplementText}}"
          data-key="moodSupplementText"
          bindinput="handleTextChange"
          maxlength="200"
          auto-height
        />
        <text class="text-count">{{moodSupplementText.length}}/200</text>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view 
      class="submit-mood-btn {{mainMood && moodIntensity ? '' : 'btn-disabled'}}" 
      bindtap="submitMoodRecord"
    >
      <text class="btn-icon">✓</text>
      <text class="btn-text">记录心情</text>
    </view>
  </view>

  <!-- 心情历史 -->
  <view class="mood-history-section card" wx:if="{{showHistory}}">
    <view class="history-header" bindtap="toggleHistory">
      <text class="history-title">心情历史</text>
      <text class="history-count">{{journals.length}}条记录</text>
      <text class="toggle-icon">▼</text>
    </view>

    <view wx:if="{{loading}}" class="loading-state">
      <text class="loading-text">加载中...</text>
    </view>

    <view wx:elif="{{journals.length === 0}}" class="empty-state">
      <text class="empty-icon">💭</text>
      <text class="empty-text">还没有心情记录</text>
      <text class="empty-hint">完成上方题目记录你的第一条心情吧</text>
    </view>

    <view wx:else class="history-list">
      <view 
        wx:for="{{journals}}" 
        wx:key="id" 
        class="history-item"
      >
        <view class="item-emoji">{{item.emoji || '😐'}}</view>
        <view class="item-content">
          <view class="item-header">
            <text class="item-mood-text">{{item.mainMoodText || item.label}}</text>
            <text class="item-time">{{formatTime(item.created_at)}}</text>
          </view>
          <text wx:if="{{item.text}}" class="item-reason">{{item.text}}</text>
          <text class="item-score" wx:if="{{item.mood_score || item.score}}">强度: {{item.mood_score || item.score}}/10</text>
        </view>
      </view>
    </view>
  </view>
</view>
