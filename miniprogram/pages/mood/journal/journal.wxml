<!--pages/mood/journal/journal.wxml-->
<view class="mood-container gradient-bg">
  <!-- å¿ƒæƒ…è®°å½•æ¨¡å— - é‡æ„ä¸ºé¢˜ç›®å½¢å¼ -->
  <view class="mood-record-section card">

    <!-- é¢˜ç›®1ï¼šä¸»è§‚æƒ…ç»ª -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">ä¸»è§‚æƒ…ç»ª</text>
        <text class="question-subtitle">æ‚¨ç°åœ¨ä¸»è¦æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ</text>
      </view>
      <view class="question-content">
        <view class="mood-options">
          <view 
            wx:for="{{questions[0].options}}" 
            wx:key="value"
            class="mood-option {{mainMood === item.value ? 'selected' : ''}}"
            bindtap="handleMoodSelect" 
            data-key="mainMood" 
            data-value="{{item.value}}"
          >
            <view class="mood-emoji">{{item.emoji}}</view>
            <text class="mood-text">{{item.text}}</text>
          </view>
        </view>
        <view wx:if="{{mainMood === 'other'}}" class="other-mood-input">
          <input placeholder="è¯·å¡«å†™å…¶ä»–æƒ…ç»ª" value="{{mainMoodOther}}"
                 data-key="mainMoodOther" bindinput="handleTextChange"/>
        </view>
      </view>
    </view>

    <!-- é¢˜ç›®2ï¼šæƒ…ç»ªå¼ºåº¦ -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">æƒ…ç»ªå¼ºåº¦</text>
        <text class="question-subtitle">æ‚¨å½“å‰æ„Ÿå—çš„å¼ºåº¦å¦‚ä½•ï¼Ÿ</text>
      </view>
      <view class="question-content">
        <radio-group class="radio-group" data-key="moodIntensity" bindchange="handleRadioChange">
          <label 
            wx:for="{{questions[1].options}}" 
            wx:key="value" 
            wx:for-item="item"
            class="radio-option {{getOptionSelected(1, item.value) ? 'selected' : ''}}"
          >
            <radio value="{{item.value}}" checked="{{getOptionSelected(1, item.value)}}" />
            <view class="option-content">
              <text class="option-text">{{item.text}}</text>
              <text class="option-desc">{{item.desc}}</text>
            </view>
          </label>
        </radio-group>
      </view>
    </view>

    <!-- é¢˜ç›®3ï¼šæƒ…ç»ªåŸå›  -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">æƒ…ç»ªåŸå› </text>
        <text class="question-subtitle">å¯¼è‡´æ­¤æƒ…ç»ªçš„åŸå› ï¼ˆå¯å¤šé€‰ï¼‰</text>
      </view>
      <view class="question-content">
        <checkbox-group class="checkbox-group" data-key="moodSupplementTags" bindchange="handleCheckboxChange">
          <label 
            wx:for="{{questions[2].options}}" 
            wx:key="value" 
            wx:for-item="item"
            class="checkbox-option {{getCheckboxSelected(2, item.value) ? 'selected' : ''}}"
          >
            <checkbox value="{{item.value}}" checked="{{getCheckboxSelected(2, item.value)}}" />
            <text class="checkbox-text">{{item.text}}</text>
          </label>
        </checkbox-group>
      </view>
    </view>

    <!-- é¢˜ç›®4ï¼šè¡¥å……è¯´æ˜ -->
    <view class="question-block">
      <view class="question-header">
        <text class="question-title">è¡¥å……è¯´æ˜</text>
        <text class="question-subtitle">è¯·ç®€çŸ­å†™ä¸‹å¯¼è‡´æ­¤æƒ…ç»ªçš„äº‹æƒ…</text>
      </view>
      <view class="question-content">
        <textarea 
          class="text-input"
          placeholder="{{questions[3].placeholder}}"
          value="{{moodSupplementText}}"
          data-key="moodSupplementText"
          bindinput="handleTextChange"
          maxlength="200"
          auto-height
        />
        <text class="text-count">{{moodSupplementText.length}}/200</text>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view 
      class="submit-mood-btn {{mainMood && moodIntensity ? '' : 'btn-disabled'}}" 
      bindtap="submitMoodRecord"
    >
      <text class="btn-icon">âœ“</text>
      <text class="btn-text">è®°å½•å¿ƒæƒ…</text>
    </view>
  </view>

  <!-- å¿ƒæƒ…å†å² -->
  <view class="mood-history-section card" wx:if="{{showHistory}}">
    <view class="history-header" bindtap="toggleHistory">
      <text class="history-title">å¿ƒæƒ…å†å²</text>
      <text class="history-count">{{journals.length}}æ¡è®°å½•</text>
      <text class="toggle-icon">â–¼</text>
    </view>

    <view wx:if="{{loading}}" class="loading-state">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <view wx:elif="{{journals.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ’­</text>
      <text class="empty-text">è¿˜æ²¡æœ‰å¿ƒæƒ…è®°å½•</text>
      <text class="empty-hint">å®Œæˆä¸Šæ–¹é¢˜ç›®è®°å½•ä½ çš„ç¬¬ä¸€æ¡å¿ƒæƒ…å§</text>
    </view>

    <view wx:else class="history-list">
      <view 
        wx:for="{{journals}}" 
        wx:key="id" 
        class="history-item"
      >
        <view class="item-emoji">{{item.emoji || 'ğŸ˜'}}</view>
        <view class="item-content">
          <view class="item-header">
            <text class="item-mood-text">{{item.mood_name || item.label}}</text>
            <text class="item-time">{{formatTime(item.created_at)}}</text>
          </view>
          <text wx:if="{{item.text}}" class="item-reason">{{item.text}}</text>
          <text class="item-score" wx:if="{{item.mood_score || item.score}}">å¼ºåº¦: {{item.mood_score || item.score}}/3</text>
        </view>
      </view>
    </view>
  </view>
</view>
