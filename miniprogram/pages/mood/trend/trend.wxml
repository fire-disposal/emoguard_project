<!-- æƒ…ç»ªè¶‹åŠ¿åˆ†æé¡µé¢ -->
<view class="page">
  <!-- æ§åˆ¶é¢æ¿ -->
  <view class="control-panel">
    <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
    <view class="time-range-selector">
      <text class="selector-label">æ—¶é—´èŒƒå›´ï¼š</text>
      <view class="range-buttons">
        <block wx:for="{{timeRanges}}" wx:key="value" wx:for-item="range">
          <button class="range-btn {{timeRange === range.value ? 'active' : ''}}"
                  data-range="{{range.value}}"
                  bindtap="onTimeRangeChange">{{range.label}}</button>
        </block>
      </view>
    </view>

  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-container" wx:if="{{!loading && trendData}}">
    <view class="stat-card">
      <view class="stat-header">
        <text class="stat-title stat-trend-{{stats.trendDepression}}">æŠ‘éƒ {{stats.trendDepression === 'up' ? 'â†‘' : stats.trendDepression === 'down' ? 'â†“' : 'â†’'}}</text>
      </view>
      <text class="stat-value">{{stats.avgDepression}}</text>
      <text class="stat-desc">å¹³å‡å€¼</text>
    </view>
    
    <view class="stat-card">
      <view class="stat-header">
        <text class="stat-title stat-trend-{{stats.trendAnxiety}}">ç„¦è™‘ {{stats.trendAnxiety === 'up' ? 'â†‘' : stats.trendAnxiety === 'down' ? 'â†“' : 'â†’'}}</text>
      </view>
      <text class="stat-value">{{stats.avgAnxiety}}</text>
      <text class="stat-desc">å¹³å‡å€¼</text>
    </view>
    
    <view class="stat-card">
      <view class="stat-header">
        <text class="stat-title stat-trend-{{stats.trendEnergy}}">ç²¾åŠ› {{stats.trendEnergy === 'up' ? 'â†‘' : stats.trendEnergy === 'down' ? 'â†“' : 'â†’'}}</text>
      </view>
      <text class="stat-value">{{stats.avgEnergy}}</text>
      <text class="stat-desc">å¹³å‡å€¼</text>
    </view>
    
    <view class="stat-card">
      <view class="stat-header">
        <text class="stat-title stat-trend-{{stats.trendSleep}}">ç¡çœ  {{stats.trendSleep === 'up' ? 'â†‘' : stats.trendSleep === 'down' ? 'â†“' : 'â†’'}}</text>
      </view>
      <text class="stat-value">{{stats.avgSleep}}</text>
      <text class="stat-desc">å¹³å‡å€¼</text>
    </view>
  </view>

  <!-- å›¾è¡¨å®¹å™¨ -->
  <view class="chart-container">
    <view class="chart-header">
      <text class="chart-title">è¶‹åŠ¿å›¾è¡¨</text>
      <view class="chart-actions">
        <button class="action-btn" bindtap="onRefresh">
          <text class="icon">â†»</text>
          åˆ·æ–°
        </button>
      </view>
    </view>
    
    <view class="chart-wrapper">
      <ec-canvas id="mychart-dom-line" canvas-id="mychart-line" ec="{{ec}}" wx:if="{{!loading && trendData}}"></ec-canvas>
      <view wx:else class="chart-placeholder">
        <text class="placeholder-text">æš‚æ— å›¾è¡¨æ•°æ®</text>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½•è¡¨å• -->
  <view class="history-container" wx:if="{{!loading && historyRecords.length > 0}}">
    <view class="history-header">
      <text class="history-title">å†å²è®°å½•</text>
      <text class="history-count">å…± {{historyRecords.length}} æ¡è®°å½•</text>
    </view>
    
    <view class="history-list">
      <block wx:for="{{historyRecords}}" wx:key="date" wx:for-item="record">
        <view class="history-item {{!record.hasData ? 'no-data' : ''}}">
          <view class="record-date">
            {{record.formattedDate}}
            <text wx:if="{{!record.hasData}}" class="no-data-label">(æ— è®°å½•)</text>
          </view>
          <view class="record-scores" wx:if="{{record.hasData}}">
            <view class="score-item">
              <text class="score-label">æŠ‘éƒ</text>
              <text class="score-value depression">{{record.depression}}</text>
            </view>
            <view class="score-item">
              <text class="score-label">ç„¦è™‘</text>
              <text class="score-value anxiety">{{record.anxiety}}</text>
            </view>
            <view class="score-item">
              <text class="score-label">ç²¾åŠ›</text>
              <text class="score-value energy">{{record.energy}}</text>
            </view>
            <view class="score-item">
              <text class="score-label">ç¡çœ </text>
              <text class="score-value sleep">{{record.sleep}}</text>
            </view>
          </view>
          <view class="no-data-placeholder" wx:else>
            <text class="no-data-text">å½“æ—¥æ— æƒ…ç»ªè®°å½•</text>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½æ•°æ®...</text>
  </view>

  <!-- ç©ºæ•°æ®çŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && (!trendData || historyRecords.length === 0)}}">
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— æƒ…ç»ªè¶‹åŠ¿æ•°æ®</text>
    <text class="empty-hint">å¼€å§‹è®°å½•æ‚¨çš„æƒ…ç»ªæµ‹è¯„ï¼ŒæŸ¥çœ‹è¶‹åŠ¿åˆ†æ</text>
  </view>
</view>
