<!-- 情绪趋势分析页面 -->
<view class="page">
  <!-- 控制面板 -->
  <view class="control-panel">
    <!-- 时间范围选择 -->
    <view class="time-range-selector">
      <text class="selector-label">时间范围：</text>
      <view class="range-buttons">
        <block wx:for="{{timeRanges}}" wx:key="value" wx:for-item="range">
          <button class="range-btn {{timeRange === range.value ? 'active' : ''}}"
                  data-range="{{range.value}}"
                  bindtap="onTimeRangeChange">{{range.label}}</button>
        </block>
      </view>
    </view>

  </view>

  <!-- 图表容器 -->
  <view class="chart-container">
    <view class="chart-header">
      <text class="chart-title">趋势图表</text>
      <view class="chart-actions">
        <button class="action-btn" bindtap="onRefresh">
          <text class="icon">↻</text>
          刷新
        </button>
        <button class="action-btn" bindtap="showAdvice">
          <text class="icon">💡</text>
          建议
        </button>
      </view>
    </view>
    
    <view class="chart-wrapper">
      <ec-canvas id="mychart-dom-line" canvas-id="mychart-line" ec="{{ec}}" wx:if="{{!loading && trendData}}"></ec-canvas>
      <view wx:else class="chart-placeholder">
        <text class="placeholder-text">暂无图表数据</text>
      </view>
    </view>
  </view>

  <!-- 历史记录表单 -->
  <view class="history-container" wx:if="{{!loading && historyRecords.length > 0}}">
    <view class="history-header">
      <text class="history-title">历史记录</text>
      <text class="history-count">共 {{historyRecords.length}} 条记录</text>
    </view>
    
    <view class="history-list">
      <block wx:for="{{historyRecords}}" wx:key="date" wx:for-item="record">
        <view class="history-item">
          <view class="record-date">{{record.formattedDate}}</view>
          <view class="record-scores">
            <view class="score-item">
              <text class="score-label">抑郁</text>
              <text class="score-value depression">{{record.depression}}</text>
            </view>
            <view class="score-item">
              <text class="score-label">焦虑</text>
              <text class="score-value anxiety">{{record.anxiety}}</text>
            </view>
            <view class="score-item">
              <text class="score-label">精力</text>
              <text class="score-value energy">{{record.energy}}</text>
            </view>
            <view class="score-item">
              <text class="score-label">睡眠</text>
              <text class="score-value sleep">{{record.sleep}}</text>
            </view>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">正在加载数据...</text>
  </view>

  <!-- 空数据状态 -->
  <view class="empty-state" wx:if="{{!loading && (!trendData || historyRecords.length === 0)}}">
    <text class="empty-icon">📊</text>
    <text class="empty-text">暂无情绪趋势数据</text>
    <text class="empty-hint">开始记录您的情绪测评，查看趋势分析</text>
  </view>
</view>
