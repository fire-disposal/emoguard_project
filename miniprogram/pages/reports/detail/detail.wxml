<!--pages/reports/detail/detail.wxml-->
<view class="report-detail-container">
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">加载中...</text>
  </view>

  <view wx:elif="{{report}}" class="report-detail">
    <!-- 历史记录类型切换区 -->
    <view class="history-switch">
      <view class="switch-btn {{historyType === 'flow' ? 'active' : ''}}" bindtap="onSwitchType" data-type="flow">测评流程</view>
      <view class="switch-btn {{historyType === 'scale' ? 'active' : ''}}" bindtap="onSwitchType" data-type="scale">单量表</view>
    </view>
    <!-- 历史记录列表 -->
    <view class="history-list card">
      <view wx:for="{{historyList}}" wx:key="id" class="history-item">
        <view class="history-main">
          <text class="history-type">{{item.type === 'flow' ? '流程' : '量表'}}</text>
          <text class="history-name">{{item.name}}</text>
        </view>
        <view class="history-info">
          <text class="history-date">{{item.date}}</text>
          <text class="history-score">分数：{{item.score}}</text>
        </view>
      </view>
      <view wx:if="{{historyList.length === 0}}" class="empty-history">暂无历史记录</view>
    </view>
    <!-- 报告标题 -->
    <view class="report-header card">
      <view class="header-top">
        <text class="report-title">{{report.report_type}}</text>
        <view class="risk-badge risk-{{report.overall_risk}}">
          {{report.overall_risk}}
        </view>
      </view>
      <text class="report-date">生成时间：{{report.created_at}}</text>
    </view>

    <!-- 综合分析 -->
    <view class="section card">
      <text class="section-title">综合分析</text>
      <text class="section-content">{{report.summary}}</text>
    </view>

    <!-- 专业建议 -->
    <view class="section card">
      <text class="section-title">专业建议</text>
      <text class="section-content">{{report.professional_advice}}</text>
    </view>

    <!-- 健康建议 -->
    <view class="section card">
      <text class="section-title">健康建议</text>
      <view class="recommendations-list">
        <view 
          wx:for="{{report.recommendations}}" 
          wx:key="index"
          class="recommendation-item"
        >
          <text class="item-dot">•</text>
          <text class="item-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- 趋势分析 -->
    <view wx:if="{{report.trend_analysis}}" class="section card">
      <text class="section-title">趋势分析</text>
      <text class="section-content">{{report.trend_analysis}}</text>
    </view>
  </view>
</view>
